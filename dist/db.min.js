!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.db=a()}}(function(){var a;return function b(a,c,d){function e(g,h){if(!c[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};a[g][0].call(k.exports,function(b){var c=a[g][1][b];return e(c?c:b)},k,k.exports,b,a,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(b,c,d){"use strict";function e(a){return a&&a.__esModule?a:{"default":a}}function f(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}var g=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(i){e=!0,f=i}finally{try{!d&&h["return"]&&h["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},i=b("idb-schema"),j=e(i),k=b("sync-promise"),l=e(k);!function(b,d){function e(a){setTimeout(function(){a()},0)}function i(a,b,c){try{var d=function(){var b=a();return c&&e(function(){c(b)}),{v:!0}}();if("object"===("undefined"==typeof d?"undefined":h(d)))return d.v}catch(f){return e(function(){b(f)}),!1}}function k(a){return a&&"object"===("undefined"==typeof a?"undefined":h(a))}function l(a){var b=Object.keys(a).sort();if(1===b.length){var c=b[0],d=a[c],e=void 0,f=void 0;switch(c){case"eq":e="only";break;case"gt":e="lowerBound",f=!0;break;case"lt":e="upperBound",f=!0;break;case"gte":e="lowerBound";break;case"lte":e="upperBound";break;default:throw new TypeError("`"+c+"` is not a valid key")}return[e,[d,f]]}var g=a[b[0]],h=a[b[1]],i=b.join("-");switch(i){case"gt-lt":case"gt-lte":case"gte-lt":case"gte-lte":return["bound",[g,h,"gt"===b[0],"lt"===b[1]]];default:throw new TypeError("`"+i+"` are conflicted keys")}}function m(a){if(a&&"object"===("undefined"==typeof a?"undefined":h(a))&&!(a instanceof p)){var b=l(a),c=g(b,2),d=c[0],e=c[1];return p[d].apply(p,f(e))}return a}var n=Object.prototype.hasOwnProperty;d.resolve=function(a){return new d(function(b,c){e(function(){b(a)})})},d.reject=function(a){return new d(function(b,c){e(function(){c(a)})})};var o=b.indexedDB||b.webkitIndexedDB||b.mozIndexedDB||b.oIndexedDB||b.msIndexedDB||b.shimIndexedDB||function(){throw new Error("IndexedDB required")}(),p=b.IDBKeyRange||b.webkitIDBKeyRange,q=function(a){return a},r=["abort","error","versionchange"],s={readonly:"readonly",readwrite:"readwrite"},t={},u=function(a,b,c,e,g){var j=this,k=null,m=function(e,j,l,m,n,o,q){return new d(function(d,r){var t=void 0;if(i(function(){t=e?p[e].apply(p,f(j)):null},r)){o=o||[],n=n||null;var u=[],v=0,w=[t],x=g||b.transaction(a,k?s.readwrite:s.readonly);x.onerror=function(a){return r(a)},x.onabort=function(a){return r(a)},x.oncomplete=function(){return d(u)};var y=x.objectStore(a),z="string"==typeof c?y.index(c):y;"count"!==l&&w.push(m||"next");var A=k?Object.keys(k):[],B=function(a){return A.forEach(function(b){var c=k[b];"function"==typeof c&&(c=c(a)),a[b]=c}),a};z[l].apply(z,w).onsuccess=function(a){var b=a.target.result;if("number"==typeof b)u=b;else if(b)if(null!==n&&n[0]>v)v=n[0],b.advance(n[0]);else if(null!==n&&v>=n[0]+n[1]);else{var c=function(){var a=!0,c="value"in b?b.value:b.key;if(!i(function(){o.forEach(function(b){b&&b.length&&(a=2===b.length?a&&c[b[0]]===b[1]:a&&b[0](c))})},r))return{v:void 0};if(a){if(v++,k&&!i(function(){c=B(c),b.update(c)},r))return{v:void 0};if(!i(function(){u.push(q(c))},r))return{v:void 0}}b["continue"]()}();if("object"===("undefined"==typeof c?"undefined":h(c)))return c.v}}}})},n=function(a,b,c){var f=[],g="next",i="openCursor",j=null,l=q,n=!1,o=e||c,p=function(){return o?d.reject(o):m(a,b,i,n?g+"unique":g,j,f,l)},r=function(){return g=null,i="count",{execute:p}},s=function(){return i="openKeyCursor",{desc:v,distinct:w,execute:p,filter:u,limit:t,map:y}},t=function(){for(var a=arguments.length,b=Array(a),c=0;a>c;c++)b[c]=arguments[c];return j=b.slice(0,2),o=j.some(function(a){return"number"!=typeof a})?new Error("limit() arguments must be numeric"):o,1===j.length&&j.unshift(0),{desc:v,distinct:w,filter:u,keys:s,execute:p,map:y,modify:x}},u=function z(){for(var a=arguments.length,b=Array(a),c=0;a>c;c++)b[c]=arguments[c];return f.push(b.slice(0,2)),{desc:v,distinct:w,execute:p,filter:z,keys:s,limit:t,map:y,modify:x}},v=function(){return g="prev",{distinct:w,execute:p,filter:u,keys:s,limit:t,map:y,modify:x}},w=function(){return n=!0,{count:r,desc:v,execute:p,filter:u,keys:s,limit:t,map:y,modify:x}},x=function(a){return k=a&&"object"===("undefined"==typeof a?"undefined":h(a))?a:null,{execute:p}},y=function(a){return l=a,{count:r,desc:v,distinct:w,execute:p,filter:u,keys:s,limit:t,modify:x}};return{count:r,desc:v,distinct:w,execute:p,filter:u,keys:s,limit:t,map:y,modify:x}};["only","bound","upperBound","lowerBound"].forEach(function(a){j[a]=function(){return n(a,arguments)}}),this.range=function(a){var b=void 0,c=[null,null];try{c=l(a)}catch(d){b=d}return n.apply(void 0,f(c).concat([b]))},this.filter=function(){var a=n(null,null);return a.filter.apply(a,arguments)},this.all=function(){return this.filter()}},v=function(a,b,c,f,g){var h=this,j=!1;if(this.getIndexedDB=function(){return a},this.isClosed=function(){return j},this.query=function(b,c){var d=j?new Error("Database has been closed"):null;return new u(b,a,c,d,g)},this.add=function(b){for(var c=arguments.length,f=Array(c>1?c-1:0),h=1;c>h;h++)f[h-1]=arguments[h];return new d(function(c,d){if(j)return void e(function(){d(new Error("Database has been closed"))});var h=f.reduce(function(a,b){return a.concat(b)},[]),l=g||a.transaction(b,s.readwrite);l.onerror=function(a){a.preventDefault(),d(a)},l.onabort=function(a){return d(a)},l.oncomplete=function(){return c(h)};var o=l.objectStore(b);h.some(function(a){var b=void 0,c=void 0;return k(a)&&n.call(a,"item")&&(c=a.key,a=a.item,null!=c&&!i(function(){c=m(c)},d))?!0:i(function(){b=null!=c?o.add(a,c):o.add(a)},d)?void(b.onsuccess=function(b){if(k(a)){var c=b.target,d=c.source.keyPath;null===d&&(d="__id__"),n.call(a,d)||Object.defineProperty(a,d,{value:c.result,enumerable:!0})}}):!0})})},this.update=function(b){for(var c=arguments.length,f=Array(c>1?c-1:0),h=1;c>h;h++)f[h-1]=arguments[h];return new d(function(c,d){if(j)return void e(function(){d(new Error("Database has been closed"))});var h=f.reduce(function(a,b){return a.concat(b)},[]),l=g||a.transaction(b,s.readwrite);l.onerror=function(a){a.preventDefault(),d(a)},l.onabort=function(a){return d(a)},l.oncomplete=function(){return c(h)};var o=l.objectStore(b);h.some(function(a){var b=void 0,c=void 0;return k(a)&&n.call(a,"item")&&(c=a.key,a=a.item,null!=c&&!i(function(){c=m(c)},d))?!0:void(i(function(){b=null!=c?o.put(a,c):o.put(a)},d)&&(b.onsuccess=function(b){if(k(a)){var c=b.target,d=c.source.keyPath;null===d&&(d="__id__"),n.call(a,d)||Object.defineProperty(a,d,{value:c.result,enumerable:!0})}}))})})},this.put=function(){return this.update.apply(this,arguments)},this.remove=function(b,c){return new d(function(d,f){if(j)return void e(function(){f(new Error("Database has been closed"))});if(i(function(){c=m(c)},f)){var h=g||a.transaction(b,s.readwrite);h.onerror=function(a){a.preventDefault(),f(a)},h.onabort=function(a){return f(a)},h.oncomplete=function(){return d(c)};var k=h.objectStore(b);!i(function(){k["delete"](c)},f)}})},this["delete"]=function(){return this.remove.apply(this,arguments)},this.del=function(){return this.remove.apply(this,arguments)},this.clear=function(b){return new d(function(c,d){if(j)return void e(function(){d(new Error("Database has been closed"))});var f=g||a.transaction(b,s.readwrite);f.onerror=function(a){return d(a)},f.onabort=function(a){return d(a)},f.oncomplete=function(){return c()};var h=f.objectStore(b);h.clear()})},this.close=function(){return new d(function(d,f){return j?void e(function(){f(new Error("Database has been closed"))}):(j=!0,delete t[b][c],a.close(),void e(function(){d()}))})},this.get=function(b,c){return new d(function(d,f){if(j)return void e(function(){f(new Error("Database has been closed"))});if(i(function(){c=m(c)},f)){var h=g||a.transaction(b);h.onerror=function(a){a.preventDefault(),f(a)},h.onabort=function(a){return f(a)};var k=h.objectStore(b),l=void 0;i(function(){l=k.get(c)},f)&&(l.onsuccess=function(a){return d(a.target.result)})}})},this.count=function(b,c){return new d(function(d,f){if(j)return void e(function(){f(new Error("Database has been closed"))});if(i(function(){c=m(c)},f)){var h=g||a.transaction(b);h.onerror=function(a){a.preventDefault(),f(a)},h.onabort=function(a){return f(a)};var k=h.objectStore(b),l=void 0;i(function(){l=null==c?k.count():k.count(c)},f)&&(l.onsuccess=function(a){return d(a.target.result)})}})},this.addEventListener=function(b,c){if(!r.includes(b))throw new Error("Unrecognized event type "+b);return"error"===b?void a.addEventListener(b,function(a){a.preventDefault(),c(a)}):void a.addEventListener(b,c)},this.removeEventListener=function(b,c){if(!r.includes(b))throw new Error("Unrecognized event type "+b);a.removeEventListener(b,c)},r.forEach(function(a){this[a]=function(b){return this.addEventListener(a,b),this}},this),!f){var l=void 0;return[].some.call(a.objectStoreNames,function(a){if(h[a])return l=new Error('The store name, "'+a+'", which you have attempted to load, conflicts with db.js method names."'),h.close(),!0;h[a]={};var b=Object.keys(h);b.filter(function(a){return![].concat(r,["close","addEventListener","removeEventListener"]).includes(a)}).map(function(b){return h[a][b]=function(){for(var c=arguments.length,d=Array(c),e=0;c>e;e++)d[e]=arguments[e];return h[b].apply(h,[a].concat(d))}})}),l}},w=function(a,b,c,d,e,f,g){if(c&&0!==c.length){if(g)for(var i=0;i<d.objectStoreNames.length;i++){var j=d.objectStoreNames[i];n.call(c,j)||d.deleteObjectStore(j)}var k=void 0;return Object.keys(c).some(function(a){var e=c[a],f=void 0;if(d.objectStoreNames.contains(a))f=b.transaction.objectStore(a);else try{f=d.createObjectStore(a,e.key)}catch(g){return k=g,!0}Object.keys(e.indexes||{}).some(function(a){try{f.index(a)}catch(b){var c=e.indexes[a];c=c&&"object"===("undefined"==typeof c?"undefined":h(c))?c:{};try{f.createIndex(a,c.keyPath||c.key||a,c)}catch(d){return k=d,!0}}})}),k}},x=function(a,b,c,d,e){var f=a.target.result;return e||(t[b][c]=f),new v(f,b,c,d,e)},y={version:"0.14.0",open:function(a){var b=a.server,c=a.noServerMethods,f=a.clearUnusedStores!==!1,g=a.version||1,k=a.schema;return t[b]||(t[b]={}),new d(function(l,m){if(t[b][g]){var n=function(){var a=x({target:{result:t[b][g]}},b,g,c);return a instanceof Error?(e(function(){m(a)}),{v:void 0}):void e(function(){l(a)})}();if("object"===("undefined"==typeof n?"undefined":h(n)))return n.v}else{var p=function(){var h=void 0;if(a.schemaBuilder&&(h=new j["default"],!i(function(){a.schemaBuilder(h);var b=h.version();if(a.version&&g>b)throw new Error("Your highest schema building (IDBSchema) version ("+b+") must not be less than your designated version ("+g+").");!a.version&&b>g&&(g=b)},m)))return{v:void 0};if("function"==typeof k)try{k=k()}catch(n){return e(function(){m(n)}),{v:void 0}}var p=o.open(b,g);p.onsuccess=function(a){var d=x(a,b,g,c);return d instanceof Error?void e(function(){m(d)}):void l(d)},p.onerror=function(a){a.preventDefault(),m(a)},p.onupgradeneeded=function(a){if(h)return void i(function(){var d=x(a,b,g,c,a.target.transaction);delete d.close,a.dbjs=function(a){return d instanceof Error?void e(function(){m(d)}):void a(d)},h.callback()(a)},m);var d=w(a,p,k,a.target.result,b,g,f);d&&e(function(){m(d)})},p.onblocked=function(a){var e=new d(function(a,d){p.onsuccess=function(e){var f=x(e,b,g,c);return f instanceof Error?void d(f):void a(f)},p.onerror=function(a){return d(a)}});a.resume=e,m(a)}}();if("object"===("undefined"==typeof p?"undefined":h(p)))return p.v}})},"delete":function(a){return new d(function(b,c){var e=o.deleteDatabase(a);e.onsuccess=function(a){return b(a)},e.onerror=function(a){return c(a)},e.onblocked=function(a){a=null===a.newVersion||"undefined"==typeof Proxy?a:new Proxy(a,{get:function(a,b){return"newVersion"===b?null:a[b]}});var b=new d(function(b,c){e.onsuccess=function(c){"newVersion"in c||(c.newVersion=a.newVersion),"oldVersion"in c||(c.oldVersion=a.oldVersion),b(c)},e.onerror=function(a){return c(a)}});a.resume=b,c(a)}})},cmp:function(a,b){return new d(function(c,d){!i(function(){return o.cmp(a,b)},d,c)})}};"undefined"!=typeof c&&"undefined"!=typeof c.exports?c.exports=y:"function"==typeof a&&a.amd?a(function(){return y}):b.db=y}(self,l["default"])},{"idb-schema":2,"sync-promise":8}],2:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a){return Array.isArray(a)?a.map(function(a){return f(a)}):(0,m["default"])(a)?Object.keys(a).reduce(function(b,c){return b[c]=f(a[c]),b},{}):a}var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();Object.defineProperty(c,"__esModule",{value:!0});var h=a("object-values"),i=d(h),j=a("is-integer"),k=d(j),l=a("is-plain-obj"),m=d(l),n=Math.pow(2,32)-1,o=function(){function a(){e(this,a),this._stores={},this._current={},this._versions={},this.version(1)}return g(a,[{key:"version",value:function(a){if(!arguments.length)return this._current.version;if(!(0,k["default"])(a)||1>a||a<this.version()||a>n)throw new TypeError("invalid version");return this._current={version:a,store:null},this._versions[a]={stores:[],dropStores:[],indexes:[],dropIndexes:[],callbacks:[],version:a},this}},{key:"addStore",value:function(a){var b=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if("string"!=typeof a||!a)throw new TypeError('"name" is required');if(this._stores[a])throw new TypeError('"'+a+'" store is already defined');var c={name:a,indexes:{},keyPath:b.key||b.keyPath||null,autoIncrement:b.increment||b.autoIncrement||!1};if(c.autoIncrement&&!c.keyPath)throw new TypeError("set keyPath in order to use autoIncrement");return this._stores[a]=c,this._versions[this.version()].stores.push(c),this._current.store=c,this}},{key:"delStore",value:function(a){if("string"!=typeof a||!a)throw new TypeError('"name" is required');var b=this._stores[a];if(!b)throw new TypeError('"'+a+'" store is not defined');return delete this._stores[a],this._versions[this.version()].dropStores.push(b),this._current.store=null,this}},{key:"getStore",value:function(a){if("string"!=typeof a||!a)throw new TypeError('"name" is required');if(!this._stores[a])throw new TypeError('"'+a+'" store is not defined');return this._current.store=this._stores[a],this}},{key:"addIndex",value:function(a,b){var c=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];if("string"!=typeof a||!a)throw new TypeError('"name" is required');if("string"!=typeof b&&!Array.isArray(b))throw new TypeError('"field" is required');var d=this._current.store;if(!d)throw new TypeError('set current store using "getStore" or "addStore"');if(d.indexes[a])throw new TypeError('"'+a+'" index is already defined');var e={name:a,field:b,storeName:d.name,multiEntry:c.multi||c.multiEntry||!1,unique:c.unique||!1};return d.indexes[a]=e,this._versions[this.version()].indexes.push(e),this}},{key:"delIndex",value:function(a){if("string"!=typeof a||!a)throw new TypeError('"name" is required');var b=this._current.store.indexes[a];if(!b)throw new TypeError('"'+a+'" index is not defined');return delete this._current.store.indexes[a],this._versions[this.version()].dropIndexes.push(b),this}},{key:"addCallback",value:function(a){return this._versions[this.version()].callbacks.push(a),this}},{key:"callback",value:function(){var a=(0,i["default"])(f(this._versions)).sort(function(a,b){return a.version-b.version});return function(b){var c=b.oldVersion>n?0:b.oldVersion,d=b.target.result,e=b.target.transaction;a.forEach(function(a){c>=a.version||(a.stores.forEach(function(a){var b={};a.keyPath&&(b.keyPath=a.keyPath),a.autoIncrement&&(b.autoIncrement=a.autoIncrement),d.createObjectStore(a.name,b)}),a.dropStores.forEach(function(a){d.deleteObjectStore(a.name)}),a.indexes.forEach(function(a){e.objectStore(a.storeName).createIndex(a.name,a.field,{unique:a.unique,multiEntry:a.multiEntry})}),a.dropIndexes.forEach(function(a){e.objectStore(a.storeName).deleteIndex(a.name)}),a.callbacks.forEach(function(a){a(b)}))})}}},{key:"stores",value:function(){return(0,i["default"])(f(this._stores)).map(function(a){return a.indexes=(0,i["default"])(a.indexes).map(function(a){return delete a.storeName,a}),a})}},{key:"clone",value:function(){var b=this,c=new a;return Object.keys(this).forEach(function(a){return c[a]=f(b[a])}),c}}]),a}();c["default"]=o,b.exports=c["default"]},{"is-integer":4,"is-plain-obj":5,"object-values":7}],3:[function(a,b,c){"use strict";var d=a("number-is-nan");b.exports=Number.isFinite||function(a){return!("number"!=typeof a||d(a)||a===1/0||a===-(1/0))}},{"number-is-nan":6}],4:[function(a,b,c){var d=a("is-finite");b.exports=Number.isInteger||function(a){return"number"==typeof a&&d(a)&&Math.floor(a)===a}},{"is-finite":3}],5:[function(a,b,c){"use strict";var d=Object.prototype.toString;b.exports=function(a){var b;return"[object Object]"===d.call(a)&&(b=Object.getPrototypeOf(a),null===b||b===Object.getPrototypeOf({}))}},{}],6:[function(a,b,c){"use strict";b.exports=Number.isNaN||function(a){return a!==a}},{}],7:[function(a,b,c){"use strict";b.exports=function(a){for(var b=Object.keys(a),c=[],d=0;d<b.length;d++)c.push(a[b[d]]);return c}},{}],8:[function(a,b,c){function d(a){return a&&"function"==typeof a.then}function e(a){function b(a,b){if(i.a=j,i.v=a,i.s=b,b===h&&!i.c[b].length)throw a;i.c[b].forEach(function(b){b(a)}),i.c=null}function c(a){i.c&&(d(a)?a.then(c)["catch"](e):b(a,g))}function e(a){i.c&&(d(a)?a.then(e)["catch"](e):b(a,h))}var i=this;i.v=0,i.s=f,i.c=[[],[]],i.a=!1;var j=!0;a(c,e),j=!1}var f=2,g=0,h=1,i=e.prototype;i.then=function(a){var b=this;if(b.a)throw new Error("Can not call then on synchonously resolved promise");return new e(function(c,d){function e(){try{c(a(b.v))}catch(e){d(e)}}b.s===g?e():b.s===h?d(b.v):(b.c[g].push(e),b.c[h].push(d))})},i["catch"]=function(a){var b=this;if(b.a)throw new Error("Can not call catch on synchonously resolved promise");return new e(function(c,d){function e(){try{c(a(b.v))}catch(e){d(e)}}b.s===h?e():b.s===g?c(b.v):(b.c[h].push(e),b.c[g].push(c))})},e.all=function(a){return new e(function(b,c,e){e=a.length,a.forEach(function(f,g){d(f)?f.then(function(c){a[g]=c,--e||b(a)})["catch"](c):--e||b(a)})})},b.exports=e},{}]},{},[1])(1)});
//# sourceMappingURL=db.min.js.map