{"version":3,"sources":["../src/db.js"],"names":["local","isObject","item","_typeof","mongoDBToKeyRangeArgs","opts","keys","Object","sort","length","key","val","name","inclusive","TypeError","x","y","pattern","mongoifyKey","IDBKeyRange","type","_mongoDBToKeyRangeArg2","apply","_toConsumableArray","args","indexedDB","webkitIndexedDB","mozIndexedDB","oIndexedDB","msIndexedDB","shimIndexedDB","Error","serverEvents","transactionModes","readonly","readwrite","timedResolve","resolveOrReject","setTimeout","console","log","closeError","reject","TimedErrorSyncPromise","cb","_syncPromise2","resolve","err","runQuery","cursorType","direction","limitRange","filters","mapper","keyRange","results","counter","transaction","trans","db","table","modifyObj","addEventListener","e","store","objectStore","indexArgs","push","modifyRecord","record","modifyKeys","forEach","cursor","target","result","advance","_ret","matchFilter","filter","propObj","_defineProperty","prop","update","v","Query","queuedError","defaultMapper","unique","execute","error","res","rej","count","desc","distinct","limit","map","start","end","some","modify","fn","_this","arguments","this","range","undefined","concat","query","all","closed","setupTransactionAndStore","records","preventDefault","adapterCb","tr","_this2","storeOpsArr","_opts","extraStores","parallel","_idbBatch","transactionalBatch","then","ops","_idbBatch2","index","IndexQuery","_key","reduce","aip","req","hasOwn","call","add","onsuccess","keyPath","source","defineProperty","value","enumerable","_key2","put","remove","del","clear","close","dbCache","version","get","eventName","handler","includes","removeEventListener","evName","noServerMethods","Array","from","objectStoreNames","storeName","_open","server","Server","open","options","clearUnusedStores","clearUnusedIndexes","schema","schemas","schemaType","openDb","s","idbimport","_idbImport2","makeSyncPromiseResolve","_val","catch","errBack","_catchState","ret","p","_addCallback","addCallback","newCb","schemaBuilder","createVersionedSchema","idbschemaVersion","resume","_retry","retry","dbName","delete","newVersion","Proxy","ev","oldVersion","request","onerror","cmp","param1","param2","module","exports","define","amd"],"mappings":"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","file":"db.min.js","sourcesContent":["import IdbImport from './idb-import';\r\nimport batch, {transactionalBatch} from 'idb-batch';\r\nimport SyncPromise from 'sync-promise';\r\n\r\n(function (local) {\r\n    'use strict';\r\n    const hasOwn = Object.prototype.hasOwnProperty;\r\n\r\n    const indexedDB = local.indexedDB || local.webkitIndexedDB ||\r\n        local.mozIndexedDB || local.oIndexedDB || local.msIndexedDB ||\r\n        local.shimIndexedDB || (function () {\r\n            throw new Error('IndexedDB required');\r\n        }());\r\n    const IDBKeyRange = local.IDBKeyRange || local.webkitIDBKeyRange;\r\n\r\n    const defaultMapper = x => x;\r\n    const serverEvents = ['abort', 'error', 'versionchange'];\r\n    const transactionModes = {\r\n        readonly: 'readonly',\r\n        readwrite: 'readwrite'\r\n    };\r\n\r\n    const dbCache = {};\r\n\r\n    function isObject (item) {\r\n        return item && typeof item === 'object';\r\n    }\r\n\r\n    function mongoDBToKeyRangeArgs (opts) {\r\n        const keys = Object.keys(opts).sort();\r\n        if (keys.length === 1) {\r\n            const key = keys[0];\r\n            const val = opts[key];\r\n            let name, inclusive;\r\n            switch (key) {\r\n            case 'eq': name = 'only'; break;\r\n            case 'gt':\r\n                name = 'lowerBound';\r\n                inclusive = true;\r\n                break;\r\n            case 'lt':\r\n                name = 'upperBound';\r\n                inclusive = true;\r\n                break;\r\n            case 'gte': name = 'lowerBound'; break;\r\n            case 'lte': name = 'upperBound'; break;\r\n            default: throw new TypeError('`' + key + '` is not a valid key');\r\n            }\r\n            return [name, [val, inclusive]];\r\n        }\r\n        const x = opts[keys[0]];\r\n        const y = opts[keys[1]];\r\n        const pattern = keys.join('-');\r\n\r\n        switch (pattern) {\r\n        case 'gt-lt': case 'gt-lte': case 'gte-lt': case 'gte-lte':\r\n            return ['bound', [x, y, keys[0] === 'gt', keys[1] === 'lt']];\r\n        default: throw new TypeError(\r\n          '`' + pattern + '` are conflicted keys'\r\n        );\r\n        }\r\n    }\r\n    function mongoifyKey (key) {\r\n        if (key && typeof key === 'object' && !(key instanceof IDBKeyRange)) {\r\n            const [type, args] = mongoDBToKeyRangeArgs(key);\r\n            return IDBKeyRange[type](...args);\r\n        }\r\n        return key;\r\n    }\r\n\r\n    // Safe to use timeout when sustaining a transaction is not needed\r\n    const timedResolve = (val, resolveOrReject) => {\r\n        setTimeout(() => {\r\n            console.log(val);\r\n            resolveOrReject(val);\r\n        });\r\n    };\r\n    const closeError = (reject) => {\r\n        timedResolve(new Error('Database has been closed'), reject);\r\n    };\r\n\r\n    const TimedErrorSyncPromise = function (cb) {\r\n        return new SyncPromise((resolve, reject) => {\r\n            try {\r\n                return cb(resolve, reject);\r\n            } catch (err) {\r\n                timedResolve(err, reject);\r\n            }\r\n        });\r\n    };\r\n\r\n    const IndexQuery = function (table, db, indexName, preexistingError, trans) {\r\n        let modifyObj = null;\r\n\r\n        const runQuery = function (type, args, cursorType, direction, limitRange, filters, mapper) {\r\n            return new TimedErrorSyncPromise(function (resolve, reject) {\r\n                const keyRange = type ? IDBKeyRange[type](...args) : null; // May throw\r\n                filters = filters || [];\r\n                limitRange = limitRange || null;\r\n\r\n                let results = [];\r\n                let counter = 0;\r\n                const indexArgs = [keyRange];\r\n\r\n                const transaction = trans || db.transaction(table, modifyObj ? transactionModes.readwrite : transactionModes.readonly);\r\n                transaction.addEventListener('error', e => reject(e));\r\n                transaction.addEventListener('abort', e => reject(e));\r\n                transaction.addEventListener('complete', () => resolve(results));\r\n\r\n                const store = transaction.objectStore(table); // if bad, db.transaction will reject first\r\n                const index = typeof indexName === 'string' ? store.index(indexName) : store;\r\n\r\n                if (cursorType !== 'count') {\r\n                    indexArgs.push(direction || 'next');\r\n                }\r\n\r\n                // Create a function that will set in the modifyObj properties into\r\n                // the passed record.\r\n                const modifyKeys = modifyObj ? Object.keys(modifyObj) : [];\r\n\r\n                const modifyRecord = function (record) {\r\n                    modifyKeys.forEach(key => {\r\n                        let val = modifyObj[key];\r\n                        if (typeof val === 'function') { val = val(record); }\r\n                        record[key] = val;\r\n                    });\r\n                    return record;\r\n                };\r\n\r\n                index[cursorType](...indexArgs).onsuccess = function (e) { // indexArgs are already validated\r\n                    const cursor = e.target.result;\r\n                    if (typeof cursor === 'number') {\r\n                        results = cursor;\r\n                    } else if (cursor) {\r\n                        if (limitRange !== null && limitRange[0] > counter) {\r\n                            counter = limitRange[0];\r\n                            cursor.advance(limitRange[0]); // Will throw on 0, but condition above prevents since counter always 0+\r\n                        } else if (limitRange !== null && counter >= (limitRange[0] + limitRange[1])) {\r\n                            // Out of limit range... skip\r\n                        } else {\r\n                            let matchFilter = true;\r\n                            let result = 'value' in cursor ? cursor.value : cursor.key;\r\n\r\n                            try { // We must manually catch for this promise as we are within an async event function\r\n                                filters.forEach(function (filter) {\r\n                                    let propObj = filter[0];\r\n                                    if (typeof propObj === 'function') {\r\n                                        matchFilter = matchFilter && propObj(result); // May throw with filter on non-object\r\n                                    } else {\r\n                                        if (!propObj || typeof propObj !== 'object') {\r\n                                            propObj = {[propObj]: filter[1]};\r\n                                        }\r\n                                        Object.keys(propObj).forEach((prop) => {\r\n                                            matchFilter = matchFilter && (result[prop] === propObj[prop]); // May throw with error in filter function\r\n                                        });\r\n                                    }\r\n                                });\r\n\r\n                                if (matchFilter) {\r\n                                    counter++;\r\n                                    // If we're doing a modify, run it now\r\n                                    if (modifyObj) {\r\n                                        result = modifyRecord(result);  // May throw\r\n                                        cursor.update(result); // May throw as `result` should only be a \"structured clone\"-able object\r\n                                    }\r\n                                    results.push(mapper(result)); // May throw\r\n                                }\r\n                            } catch (err) {\r\n                                reject(err);\r\n                                return;\r\n                            }\r\n                            cursor.continue();\r\n                        }\r\n                    }\r\n                };\r\n            });\r\n        };\r\n\r\n        const Query = function (type, args, queuedError) {\r\n            const filters = [];\r\n            let direction = 'next';\r\n            let cursorType = 'openCursor';\r\n            let limitRange = null;\r\n            let mapper = defaultMapper;\r\n            let unique = false;\r\n            let error = preexistingError || queuedError;\r\n\r\n            const execute = function () {\r\n                if (error) {\r\n                    return new TimedErrorSyncPromise(function (res, rej) {\r\n                        throw error;\r\n                    });\r\n                }\r\n                return runQuery(type, args, cursorType, unique ? direction + 'unique' : direction, limitRange, filters, mapper);\r\n            };\r\n\r\n            const count = function () {\r\n                direction = null;\r\n                cursorType = 'count';\r\n                return {execute};\r\n            };\r\n\r\n            const keys = function () {\r\n                cursorType = 'openKeyCursor';\r\n                return {desc, distinct, execute, filter, limit, map};\r\n            };\r\n\r\n            const limit = function (start, end) {\r\n                limitRange = !end ? [0, start] : [start, end];\r\n                error = limitRange.some(val => typeof val !== 'number') ? new Error('limit() arguments must be numeric') : error;\r\n                return {desc, distinct, filter, keys, execute, map, modify};\r\n            };\r\n\r\n            const filter = function (prop, val) {\r\n                filters.push([prop, val]);\r\n                return {desc, distinct, execute, filter, keys, limit, map, modify};\r\n            };\r\n\r\n            const desc = function () {\r\n                direction = 'prev';\r\n                return {distinct, execute, filter, keys, limit, map, modify};\r\n            };\r\n\r\n            const distinct = function () {\r\n                unique = true;\r\n                return {count, desc, execute, filter, keys, limit, map, modify};\r\n            };\r\n\r\n            const modify = function (update) {\r\n                modifyObj = update && typeof update === 'object' ? update : null;\r\n                return {execute};\r\n            };\r\n\r\n            const map = function (fn) {\r\n                mapper = fn;\r\n                return {count, desc, distinct, execute, filter, keys, limit, modify};\r\n            };\r\n\r\n            return {count, desc, distinct, execute, filter, keys, limit, map, modify};\r\n        };\r\n\r\n        ['only', 'bound', 'upperBound', 'lowerBound'].forEach((name) => {\r\n            this[name] = function () {\r\n                return Query(name, arguments);\r\n            };\r\n        });\r\n\r\n        this.range = function (opts) {\r\n            let error;\r\n            let keyRange = [null, null];\r\n            try {\r\n                keyRange = mongoDBToKeyRangeArgs(opts);\r\n            } catch (e) {\r\n                error = e;\r\n            }\r\n            return Query(...keyRange, error);\r\n        };\r\n\r\n        this.filter = function (...args) {\r\n            const query = Query(null, null);\r\n            return query.filter(...args);\r\n        };\r\n\r\n        this.all = function () {\r\n            return this.filter();\r\n        };\r\n    };\r\n\r\n    const Server = function (db, name, version, noServerMethods) {\r\n        let closed = false;\r\n        let trans;\r\n        const setupTransactionAndStore = (db, table, records, resolve, reject, readonly) => {\r\n            const transaction = trans || db.transaction(table, readonly ? transactionModes.readonly : transactionModes.readwrite);\r\n            transaction.addEventListener('error', e => {\r\n                // prevent throwing aborting (hard)\r\n                // https://bugzilla.mozilla.org/show_bug.cgi?id=872873\r\n                e.preventDefault();\r\n                reject(e);\r\n            });\r\n            transaction.addEventListener('abort', e => reject(e));\r\n            transaction.addEventListener('complete', () => resolve(records));\r\n            return transaction.objectStore(table);\r\n        };\r\n        const adapterCb = (tr, cb) => {\r\n            if (!trans) trans = tr;\r\n            return cb(tr, this);\r\n        };\r\n\r\n        this.getIndexedDB = () => db;\r\n        this.isClosed = () => closed;\r\n\r\n        this.batch = function (storeOpsArr, opts = {extraStores: [], parallel: false}) {\r\n            opts = opts || {};\r\n            var {extraStores, parallel} = opts; // We avoid `resolveEarly`\r\n            return transactionalBatch(db, storeOpsArr, {adapterCb, extraStores, parallel}).then((res) => {\r\n                trans = undefined;\r\n                return res;\r\n            });\r\n        };\r\n        this.tableBatch = function (table, ops, opts = {parallel: false}) {\r\n            opts = opts || {};\r\n            return batch(db, table, ops, {adapterCb, parallel: opts.parallel}).then((res) => {\r\n                trans = undefined;\r\n                return res;\r\n            });\r\n        };\r\n\r\n        this.query = function (table, index) {\r\n            const error = closed ? new Error('Database has been closed') : null;\r\n            return new IndexQuery(table, db, index, error, trans); // Does not throw by itself\r\n        };\r\n\r\n        this.add = function (table, ...args) {\r\n            return new TimedErrorSyncPromise(function (resolve, reject) {\r\n                if (closed) {\r\n                    closeError(reject);\r\n                    return;\r\n                }\r\n\r\n                const records = args.reduce(function (records, aip) {\r\n                    return records.concat(aip);\r\n                }, []);\r\n\r\n                const store = setupTransactionAndStore(db, table, records, resolve, reject);\r\n\r\n                records.some(function (record) {\r\n                    let req, key;\r\n                    if (isObject(record) && hasOwn.call(record, 'item')) {\r\n                        key = record.key;\r\n                        record = record.item;\r\n                        if (key != null) {\r\n                            key = mongoifyKey(key); // May throw\r\n                        }\r\n                    }\r\n\r\n                    // Safe to add since in readwrite, but may still throw\r\n                    if (key != null) {\r\n                        req = store.add(record, key);\r\n                    } else {\r\n                        req = store.add(record);\r\n                    }\r\n\r\n                    req.onsuccess = function (e) {\r\n                        if (!isObject(record)) {\r\n                            return;\r\n                        }\r\n                        const target = e.target;\r\n                        let keyPath = target.source.keyPath;\r\n                        if (keyPath === null) {\r\n                            keyPath = '__id__';\r\n                        }\r\n                        if (hasOwn.call(record, keyPath)) {\r\n                            return;\r\n                        }\r\n                        Object.defineProperty(record, keyPath, {\r\n                            value: target.result,\r\n                            enumerable: true\r\n                        });\r\n                    };\r\n                });\r\n            });\r\n        };\r\n\r\n        this.update = function (table, ...args) {\r\n            return new TimedErrorSyncPromise(function (resolve, reject) {\r\n                if (closed) {\r\n                    closeError(reject);\r\n                    return;\r\n                }\r\n\r\n                const records = args.reduce(function (records, aip) {\r\n                    return records.concat(aip);\r\n                }, []);\r\n\r\n                const store = setupTransactionAndStore(db, table, records, resolve, reject);\r\n\r\n                records.some(function (record) {\r\n                    let req, key;\r\n                    if (isObject(record) && hasOwn.call(record, 'item')) {\r\n                        key = record.key;\r\n                        record = record.item;\r\n                        if (key != null) {\r\n                            key = mongoifyKey(key); // May throw\r\n                        }\r\n                    }\r\n                    // These can throw DataError, e.g., if function passed in\r\n                    if (key != null) {\r\n                        req = store.put(record, key);\r\n                    } else {\r\n                        req = store.put(record);\r\n                    }\r\n\r\n                    req.onsuccess = function (e) {\r\n                        if (!isObject(record)) {\r\n                            return;\r\n                        }\r\n                        const target = e.target;\r\n                        let keyPath = target.source.keyPath;\r\n                        if (keyPath === null) {\r\n                            keyPath = '__id__';\r\n                        }\r\n                        if (hasOwn.call(record, keyPath)) {\r\n                            return;\r\n                        }\r\n                        Object.defineProperty(record, keyPath, {\r\n                            value: target.result,\r\n                            enumerable: true\r\n                        });\r\n                    };\r\n                });\r\n            });\r\n        };\r\n\r\n        this.put = function (...args) {\r\n            return this.update(...args);\r\n        };\r\n\r\n        this.remove = function (table, key) {\r\n            return new TimedErrorSyncPromise(function (resolve, reject) {\r\n                if (closed) {\r\n                    closeError(reject);\r\n                    return;\r\n                }\r\n                key = mongoifyKey(key); // May throw\r\n\r\n                const store = setupTransactionAndStore(db, table, key, resolve, reject);\r\n\r\n                store.delete(key); // May throw\r\n            });\r\n        };\r\n\r\n        this.del = this.delete = function (...args) {\r\n            return this.remove(...args);\r\n        };\r\n\r\n        this.clear = function (table) {\r\n            return new TimedErrorSyncPromise(function (resolve, reject) {\r\n                if (closed) {\r\n                    closeError(reject);\r\n                    return;\r\n                }\r\n                const store = setupTransactionAndStore(db, table, undefined, resolve, reject);\r\n                store.clear();\r\n            });\r\n        };\r\n\r\n        this.close = function () {\r\n            return new TimedErrorSyncPromise(function (resolve, reject) {\r\n                if (closed) {\r\n                    closeError(reject);\r\n                    return;\r\n                }\r\n                closed = true;\r\n                delete dbCache[name][version];\r\n                db.close();\r\n                timedResolve(undefined, resolve);\r\n            });\r\n        };\r\n\r\n        this.get = function (table, key) {\r\n            return new TimedErrorSyncPromise(function (resolve, reject) {\r\n                if (closed) {\r\n                    closeError(reject);\r\n                    return;\r\n                }\r\n                key = mongoifyKey(key); // May throw\r\n\r\n                const store = setupTransactionAndStore(db, table, undefined, resolve, reject, true);\r\n\r\n                const req = store.get(key);\r\n                req.onsuccess = e => resolve(e.target.result);\r\n            });\r\n        };\r\n\r\n        this.count = function (table, key) {\r\n            return new TimedErrorSyncPromise((resolve, reject) => {\r\n                if (closed) {\r\n                    closeError(reject);\r\n                    return;\r\n                }\r\n                key = mongoifyKey(key); // May throw\r\n\r\n                const store = setupTransactionAndStore(db, table, undefined, resolve, reject, true);\r\n\r\n                const req = key == null ? store.count() : store.count(key); // May throw\r\n                req.onsuccess = e => resolve(e.target.result);\r\n            });\r\n        };\r\n\r\n        this.addEventListener = function (eventName, handler) {\r\n            if (!serverEvents.includes(eventName)) {\r\n                throw new Error('Unrecognized event type ' + eventName);\r\n            }\r\n            if (eventName === 'error') {\r\n                db.addEventListener(eventName, function (e) {\r\n                    e.preventDefault(); // Needed to prevent hard abort with ConstraintError\r\n                    handler(e);\r\n                });\r\n                return;\r\n            }\r\n            db.addEventListener(eventName, handler);\r\n        };\r\n\r\n        this.removeEventListener = function (eventName, handler) {\r\n            if (!serverEvents.includes(eventName)) {\r\n                throw new Error('Unrecognized event type ' + eventName);\r\n            }\r\n            db.removeEventListener(eventName, handler);\r\n        };\r\n\r\n        serverEvents.forEach(function (evName) {\r\n            this[evName] = function (handler) {\r\n                this.addEventListener(evName, handler);\r\n                return this;\r\n            };\r\n        }, this);\r\n\r\n        if (noServerMethods) {\r\n            return;\r\n        }\r\n\r\n        let err;\r\n        Array.from(db.objectStoreNames).some(storeName => {\r\n            if (this[storeName]) {\r\n                err = new Error('The store name, \"' + storeName + '\", which you have attempted to load, conflicts with db.js method names.\"');\r\n                this.close();\r\n                return true;\r\n            }\r\n            this[storeName] = {};\r\n            const keys = Object.keys(this);\r\n            keys.filter(key => !(([...serverEvents, 'close', 'batch', 'addEventListener', 'removeEventListener']).includes(key)))\r\n                .map(key =>\r\n                    this[storeName][key] = (...args) => this[key](storeName, ...args)\r\n                );\r\n        });\r\n        return err;\r\n    };\r\n\r\n    const open = function (db, server, version, noServerMethods) {\r\n        dbCache[server][version] = db;\r\n\r\n        return new Server(db, server, version, noServerMethods);\r\n    };\r\n\r\n    const db = {\r\n        version: '0.15.0',\r\n        open: function (options) {\r\n            const server = options.server;\r\n            const noServerMethods = options.noServerMethods;\r\n            const clearUnusedStores = options.clearUnusedStores !== false;\r\n            const clearUnusedIndexes = options.clearUnusedIndexes !== false;\r\n            let version = options.version || 1;\r\n            let schema = options.schema;\r\n            let schemas = options.schemas;\r\n            let schemaType = options.schemaType || (schema ? 'whole' : 'mixed');\r\n            if (!dbCache[server]) {\r\n                dbCache[server] = {};\r\n            }\r\n\r\n            return new TimedErrorSyncPromise(function (resolve, reject) {\r\n                const openDb = function (db) {\r\n                    const s = open(db, server, version, noServerMethods);\r\n                    if (s instanceof Error) {\r\n                        timedResolve(s, reject);\r\n                        return;\r\n                    }\r\n                    return s;\r\n                };\r\n                if (dbCache[server][version]) {\r\n                    const s = open(dbCache[server][version], server, version, noServerMethods);\r\n                    if (s instanceof Error) {\r\n                        timedResolve(s, reject);\r\n                        return;\r\n                    }\r\n                    timedResolve(s, resolve); // db should outlast a short timeout\r\n                    return;\r\n                }\r\n                const idbimport = new IdbImport();\r\n                const makeSyncPromiseResolve = (val) => {\r\n                    return {\r\n                        _val: val,\r\n                        catch: function (errBack) {\r\n                            if (!this._catchState) {\r\n                                return this;\r\n                            }\r\n                            this._catchState = false;\r\n                            let ret;\r\n                            try {\r\n                                ret = errBack(this._val);\r\n                            } catch (err) {\r\n                                this._catchState = true;\r\n                                return this;\r\n                            }\r\n                            // We can afford to be synchronous here, as just a place-holder\r\n                            return ret && ret.then ? ret : makeSyncPromiseResolve(ret);\r\n                        },\r\n                        then: function (cb) {\r\n                            if (this._catchState) {\r\n                                return this;\r\n                            }\r\n                            let ret;\r\n                            try {\r\n                                ret = cb(this._val);\r\n                            } catch (err) {\r\n                                this._catchState = true;\r\n                                return this;\r\n                            }\r\n                            // We can afford to be synchronous here, as just a place-holder\r\n                            return ret && ret.then ? ret : makeSyncPromiseResolve(ret);\r\n                        }\r\n                    };\r\n                };\r\n                let p = makeSyncPromiseResolve();\r\n                if (schema || schemas || options.schemaBuilder) {\r\n                    const _addCallback = idbimport.addCallback;\r\n                    idbimport.addCallback = function (cb) {\r\n                        function newCb (db) {\r\n                            const s = open(db, server, version, noServerMethods);\r\n                            if (s instanceof Error) {\r\n                                throw s;\r\n                            }\r\n                            return cb(db, s);\r\n                        }\r\n                        return _addCallback.call(idbimport, newCb);\r\n                    };\r\n\r\n                    p = p.then(() => {\r\n                        if (options.schemaBuilder) {\r\n                            return options.schemaBuilder(idbimport);\r\n                        }\r\n                    }).then(() => {\r\n                        if (schema) {\r\n                            switch (schemaType) {\r\n                            case 'mixed': case 'idb-schema': case 'merge': case 'whole': {\r\n                                schemas = {[version]: schema};\r\n                                break;\r\n                            }\r\n                            }\r\n                        }\r\n                        if (schemas) {\r\n                            idbimport.createVersionedSchema(schemas, schemaType, clearUnusedStores, clearUnusedIndexes);\r\n                        }\r\n                        const idbschemaVersion = idbimport.version();\r\n                        if (options.version && idbschemaVersion < version) {\r\n                            throw new Error(\r\n                                'Your highest schema building (IDBSchema) version (' + idbschemaVersion + ') ' +\r\n                                'must not be less than your designated version (' + version + ').'\r\n                            );\r\n                        }\r\n                        if (!options.version && idbschemaVersion > version) {\r\n                            version = idbschemaVersion;\r\n                        }\r\n                    });\r\n                }\r\n\r\n                p.then(() => {\r\n                    return idbimport.open(server, version);\r\n                }).catch((err) => {\r\n                    if (err.resume) {\r\n                        err.resume = err.resume.then(openDb);\r\n                    }\r\n                    if (err.retry) {\r\n                        const _retry = err.retry;\r\n                        err.retry = function () {\r\n                            _retry.call(err).then(openDb);\r\n                        };\r\n                    }\r\n                    throw err;\r\n                }).then(openDb).then(resolve).catch((e) => {\r\n                    timedResolve(e, reject);\r\n                });\r\n            });\r\n        },\r\n\r\n        del: function (dbName) {\r\n            return this.delete(dbName);\r\n        },\r\n        delete: function (dbName) {\r\n            return new SyncPromise(function (resolve, reject) {\r\n                const request = indexedDB.deleteDatabase(dbName); // Does not throw\r\n\r\n                request.onsuccess = e => {\r\n                    // The following is needed currently by PhantomJS (though we cannot polyfill `oldVersion`): https://github.com/ariya/phantomjs/issues/14141\r\n                    if (!('newVersion' in e)) {\r\n                        e.newVersion = null;\r\n                    }\r\n                    resolve(e);\r\n                };\r\n                request.onerror = e => { // No errors currently\r\n                    e.preventDefault();\r\n                    reject(e);\r\n                };\r\n                request.onblocked = e => {\r\n                    // The following addresses part of https://bugzilla.mozilla.org/show_bug.cgi?id=1220279\r\n                    e = e.newVersion === null || typeof Proxy === 'undefined' ? e : new Proxy(e, {get: function (target, name) {\r\n                        return name === 'newVersion' ? null : target[name];\r\n                    }});\r\n                    const resume = new SyncPromise(function (res, rej) {\r\n                        // We overwrite handlers rather than make a new\r\n                        //   delete() since the original request is still\r\n                        //   open and its onsuccess will still fire if\r\n                        //   the user unblocks by closing the blocking\r\n                        //   connection\r\n                        request.onsuccess = ev => {\r\n                            // The following are needed currently by PhantomJS: https://github.com/ariya/phantomjs/issues/14141\r\n                            if (!('newVersion' in ev)) {\r\n                                ev.newVersion = e.newVersion;\r\n                            }\r\n\r\n                            if (!('oldVersion' in ev)) {\r\n                                ev.oldVersion = e.oldVersion;\r\n                            }\r\n\r\n                            res(ev);\r\n                        };\r\n                        request.onerror = e => {\r\n                            e.preventDefault();\r\n                            rej(e);\r\n                        };\r\n                    });\r\n                    e.resume = resume;\r\n                    reject(e);\r\n                };\r\n            });\r\n        },\r\n\r\n        cmp: function (param1, param2) {\r\n            return new SyncPromise(function (resolve, reject) {\r\n                setTimeout(function () {\r\n                    let res;\r\n                    try {\r\n                        res = indexedDB.cmp(param1, param2); // May throw\r\n                    } catch (err) {\r\n                        reject(err);\r\n                        return;\r\n                    }\r\n                    resolve(res);\r\n                });\r\n            });\r\n        }\r\n    };\r\n\r\n    if (typeof module !== 'undefined' && typeof module.exports !== 'undefined') {\r\n        module.exports = db;\r\n    } else if (typeof define === 'function' && define.amd) {\r\n        define(function () { return db; });\r\n    } else {\r\n        local.db = db;\r\n    }\r\n}(self));\r\n"]}